  <!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Meu Controle Financeiro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --primaria:#1e88e5;
  --verde:#2e7d32;
  --vermelho:#c62828;
  --amarelo:#f9a825;
  --fundo:#f4f6f8;
}

body{
  margin:0;
  padding:15px;
  font-family:Segoe UI, Arial, sans-serif;
  background:linear-gradient(180deg,#e3f2fd,#f4f6f8);
}

h1{text-align:center;margin-bottom:5px;}
.sub{text-align:center;color:#555;margin-bottom:15px;}

.card{
  background:#fff;
  border-radius:14px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}

h3{margin-top:0;}

input,select,button{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:10px;
  border:1px solid #ddd;
  font-size:16px;
}

button{
  background:var(--primaria);
  color:#fff;
  border:none;
  font-weight:600;
}

.resumo{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.box{
  padding:12px;
  border-radius:12px;
  text-align:center;
  font-weight:600;
}

.ganho{background:#e8f5e9;color:var(--verde);}
.despesa{background:#ffebee;color:var(--vermelho);}
.saldo{
  grid-column:1/3;
  background:#e3f2fd;
  color:#0d47a1;
  font-size:18px;
}

.alerta{
  padding:10px;
  border-radius:10px;
  margin-bottom:10px;
  font-weight:600;
}

.vencido{background:#ffcdd2;color:#b71c1c;}
.hoje{background:#fff9c4;color:#f57f17;}
.proximo{background:#e3f2fd;color:#0d47a1;}

.item{
  padding:8px;
  border-bottom:1px solid #eee;
}
</style>
</head>

<body>

<h1>üí∞ Meu Controle</h1>
<p class="sub">Financeiro pessoal</p>

<div class="card">
<h3>‚ûï Novo Lan√ßamento</h3>

<select id="tipo">
<option value="ganho">Ganho</option>
<option value="despesa">Despesa</option>
</select>

<select id="categoria">
<option>Sal√°rio</option>
<option>Alimenta√ß√£o</option>
<option>Combust√≠vel</option>
<option>Compras Extras</option>
<option>Cart√µes</option>
<option>Moto</option>
<option>Faculdade</option>
<option>Empr√©stimos</option>
<option>Outros</option>
</select>

<input id="descricao" placeholder="Descri√ß√£o">
<input id="valor" type="number" placeholder="Valor (R$)">
<input id="data" type="date">
<button onclick="adicionar()">Adicionar</button>
</div>

<div class="card resumo">
<div class="box ganho">Ganhos<br>R$ <span id="ganhos">0</span></div>
<div class="box despesa">Despesas<br>R$ <span id="despesas">0</span></div>
<div class="box saldo">Saldo<br>R$ <span id="saldo">0</span></div>
</div>

<div class="card">
<h3>üîî Alertas</h3>
<div id="alertas"></div>
</div>

<div class="card">
<h3>üìÜ Vis√£o Mensal</h3>
<input type="month" id="mesFiltro" onchange="renderizar()">
</div>

<div class="card">
<h3>üìä Gastos por Categoria</h3>
<canvas id="grafico"></canvas>
</div>

<div class="card">
<h3>‚òÅÔ∏è Backup</h3>
<button onclick="backup()">Baixar backup</button>
</div>

<div class="card">
<h3>üìú Hist√≥rico</h3>
<div id="lista"></div>
</div>

<script>
let dados = JSON.parse(localStorage.getItem("financeiro")) || [];

function salvar(){
  localStorage.setItem("financeiro",JSON.stringify(dados));
}

function adicionar(){
  const obj={
    tipo:tipo.value,
    categoria:categoria.value,
    descricao:descricao.value,
    valor:Number(valor.value),
    data:data.value
  };
  if(!obj.descricao||!obj.valor) return;
  dados.push(obj);
  salvar();
  renderizar();
  descricao.value="";valor.value="";
}

function backup(){
  const blob=new Blob([JSON.stringify(dados)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="backup_financeiro.json";
  a.click();
}

let chart;

function renderizar(){
  let g=0,d=0;
  lista.innerHTML="";
  alertas.innerHTML="";

  const hoje=new Date();
  const filtro=mesFiltro.value;

  const categorias={};

  dados.forEach(x=>{
    if(filtro && !x.data.startsWith(filtro)) return;

    x.tipo==="ganho"?g+=x.valor:d+=x.valor;

    if(x.tipo==="despesa"){
      categorias[x.categoria]=(categorias[x.categoria]||0)+x.valor;

      if(x.data){
        const venc=new Date(x.data);
        const diff=(venc-hoje)/86400000;
        if(diff<0) alertas.innerHTML+=`<div class="alerta vencido">‚ùå ${x.descricao} vencido</div>`;
        else if(diff<=1) alertas.innerHTML+=`<div class="alerta hoje">‚ö†Ô∏è ${x.descricao} vence hoje</div>`;
        else if(diff<=3) alertas.innerHTML+=`<div class="alerta proximo">‚è≥ ${x.descricao} vence em breve</div>`;
      }
    }

    lista.innerHTML+=`<div class="item">${x.categoria} | ${x.descricao} ‚Äî R$ ${x.valor.toFixed(2)}</div>`;
  });

  ganhos.textContent=g.toFixed(2);
  despesas.textContent=d.toFixed(2);
  saldo.textContent=(g-d).toFixed(2);

  if(chart) chart.destroy();
  chart=new Chart(grafico,{
    type:"pie",
    data:{
      labels:Object.keys(categorias),
      datasets:[{data:Object.values(categorias)}]
    }
  });
}

renderizar();
</script>

</body>
</html>
