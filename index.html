import { useState, useEffect } from "react"; import { Card, CardContent } from "@/components/ui/card"; import { Button } from "@/components/ui/button"; import { Input } from "@/components/ui/input"; import { motion } from "framer-motion"; import * as pdfjsLib from "pdfjs-dist";

pdfjsLib.GlobalWorkerOptions.workerSrc = //cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js;

const CATEGORIAS = [ "Alimentação", "Combustível", "Moradia", "Compras Extras", "Faculdade", "Moto", "Cartão Nubank", "Cartão PAN", "Cartão Inter", "Empréstimo Nubank", "Empréstimo 99", "Outros" ];

export default function FinanceApp() { const [registros, setRegistros] = useState(() => { const saved = localStorage.getItem("financeApp"); return saved ? JSON.parse(saved) : []; });

const [form, setForm] = useState({ tipo: "Despesa", categoria: "Alimentação", descricao: "", valor: "", mes: new Date().toLocaleString("pt-BR", { month: "long" }) });

const [pdfText, setPdfText] = useState("");

useEffect(() => { localStorage.setItem("financeApp", JSON.stringify(registros)); }, [registros]);

const addRegistro = () => { if (!form.descricao || !form.valor) return; setRegistros([...registros, { ...form, valor: Number(form.valor) }]); setForm({ ...form, descricao: "", valor: "" }); };

const handlePDF = async (file) => { const arrayBuffer = await file.arrayBuffer(); const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise; let text = ""; for (let i = 1; i <= pdf.numPages; i++) { const page = await pdf.getPage(i); const content = await page.getTextContent(); text += content.items.map(i => i.str).join(" ") + "\n"; } setPdfText(text); };

const totaisPorCategoria = CATEGORIAS.map(cat => ({ categoria: cat, total: registros.filter(r => r.categoria === cat) .reduce((a, b) => a + b.valor, 0) }));

const totalGanhos = registros.filter(r => r.tipo === "Ganho") .reduce((a, b) => a + b.valor, 0);

const totalDespesas = registros.filter(r => r.tipo === "Despesa") .reduce((a, b) => a + b.valor, 0);

return ( <div className="min-h-screen bg-gray-100 p-4"> <motion.h1 initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="text-2xl font-bold mb-4"> Central Financeira Pessoal </motion.h1>

<Card className="mb-4">
    <CardContent className="p-4 grid gap-2">
      <select className="border p-2 rounded" value={form.tipo}
        onChange={e => setForm({ ...form, tipo: e.target.value })}>
        <option>Ganho</option>
        <option>Despesa</option>
      </select>

      <select className="border p-2 rounded" value={form.categoria}
        onChange={e => setForm({ ...form, categoria: e.target.value })}>
        {CATEGORIAS.map(c => <option key={c}>{c}</option>)}
      </select>

      <Input placeholder="Descrição" value={form.descricao}
        onChange={e => setForm({ ...form, descricao: e.target.value })} />

      <Input type="number" placeholder="Valor" value={form.valor}
        onChange={e => setForm({ ...form, valor: e.target.value })} />

      <Button onClick={addRegistro}>Adicionar</Button>
    </CardContent>
  </Card>

  <Card className="mb-4">
    <CardContent className="p-4">
      <p>Ganhos: <b>R$ {totalGanhos.toFixed(2)}</b></p>
      <p>Despesas: <b>R$ {totalDespesas.toFixed(2)}</b></p>
      <p className="font-bold">Saldo: R$ {(totalGanhos - totalDespesas).toFixed(2)}</p>
    </CardContent>
  </Card>

  <Card className="mb-4">
    <CardContent className="p-4">
      <h2 className="font-semibold mb-2">Leitor de Fatura (PDF)</h2>
      <Input type="file" accept="application/pdf" onChange={e => handlePDF(e.target.files[0])} />
      <textarea className="w-full h-32 mt-2 p-2 border rounded" value={pdfText} readOnly />
      <p className="text-xs text-gray-600">*O texto do PDF é lido no seu navegador. Nenhum arquivo é enviado.</p>
    </CardContent>
  </Card>

  <Card>
    <CardContent className="p-4">
      <h2 className="font-semibold mb-2">Relatório por Categoria</h2>
      {totaisPorCategoria.map(c => (
        <div key={c.categoria} className="flex justify-between text-sm border-b py-1">
          <span>{c.categoria}</span>
          <span>R$ {c.total.toFixed(2)}</span>
        </div>
      ))}
    </CardContent>
  </Card>
</div>

); }
