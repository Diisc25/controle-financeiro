<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Financeiro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; margin:0; padding:15px; }
h1 { text-align:center; }
h3 { margin-top:0; }
input, select, button {
  width:100%; padding:10px; margin:5px 0; font-size:16px;
}
button { background:#1e88e5; color:#fff; border:none; border-radius:6px; }
.card { background:#fff; padding:15px; border-radius:10px; margin-bottom:15px; }
.item { border-bottom:1px solid #ddd; padding:5px 0; }
small { color:#666; }
</style>
</head>

<body>

<h1>ðŸ“Š Controle Financeiro</h1>
<p style="text-align:center">Web App pessoal</p>

<div class="card">
<h3>âž• Novo LanÃ§amento</h3>

<select id="tipo">
<option value="ganho">Ganho</option>
<option value="despesa">Despesa</option>
</select>

<select id="categoria">
<option>SalÃ¡rio</option>
<option>ComissÃ£o Recebida</option>
<option>ComissÃ£o a Receber</option>
<option>AlimentaÃ§Ã£o</option>
<option>CombustÃ­vel</option>
<option>Compras Extras</option>
<option>Moto</option>
<option>Faculdade</option>
<option>CartÃµes</option>
<option>EmprÃ©stimos</option>
<option>Outros</option>
</select>

<input id="descricao" placeholder="DescriÃ§Ã£o">
<input id="valor" type="number" placeholder="Valor (R$)">
<button onclick="adicionar()">Adicionar</button>
</div>

<div class="card">
<h3>ðŸ“Š Resumo</h3>
<p>ðŸ’° Ganhos: R$ <span id="ganhos">0</span></p>
<p>ðŸ“‰ Despesas: R$ <span id="despesas">0</span></p>
<p><b>Saldo: R$ <span id="saldo">0</span></b></p>
</div>

<div class="card">
<h3>ðŸ“„ Importar Fatura (PDF)</h3>
<input type="file" accept="application/pdf" onchange="lerPDF(this)">
<small>Leitura automÃ¡tica de valores da fatura.</small>
</div>

<div class="card">
<h3>ðŸ“œ HistÃ³rico</h3>
<div id="lista"></div>
</div>

<script>
let dados = JSON.parse(localStorage.getItem("financeiro")) || [];

function salvar() {
  localStorage.setItem("financeiro", JSON.stringify(dados));
}

function adicionar() {
  const tipo = document.getElementById("tipo").value;
  const categoria = document.getElementById("categoria").value;
  const descricao = document.getElementById("descricao").value;
  const valor = Number(document.getElementById("valor").value);

  if (!descricao || !valor) return;

  dados.push({ tipo, categoria, descricao, valor });
  salvar();
  renderizar();

  document.getElementById("descricao").value = "";
  document.getElementById("valor").value = "";
}

async function lerPDF(input) {
  const file = input.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = async function () {
    const typedarray = new Uint8Array(this.result);
    const pdf = await pdfjsLib.getDocument(typedarray).promise;

    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const text = await page.getTextContent();

      text.items.forEach(item => {
        const match = item.str.match(/\\d+,\\d{2}/);
        if (match) {
          dados.push({
            tipo: "despesa",
            categoria: "CartÃµes",
            descricao: "Fatura PDF",
            valor: Number(match[0].replace(",", "."))
          });
        }
      });
    }

    salvar();
    renderizar();
    alert("PDF processado! Confira o histÃ³rico.");
  };
  reader.readAsArrayBuffer(file);
}

function renderizar() {
  let ganhos = 0, despesas = 0;
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  dados.forEach(d => {
    if (d.tipo === "ganho") ganhos += d.valor;
    else despesas += d.valor;

    const div = document.createElement("div");
    div.className = "item";
    div.innerText = `${d.categoria} | ${d.descricao} - R$ ${d.valor.toFixed(2)}`;
    lista.appendChild(div);
  });

  document.getElementById("ganhos").innerText = ganhos.toFixed(2);
  document.getElementById("despesas").innerText = despesas.toFixed(2);
  document.getElementById("saldo").innerText = (ganhos - despesas).toFixed(2);
}

renderizar();
</script>

</body>
</html>
